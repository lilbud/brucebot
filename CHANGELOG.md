# CHANGELOG

### This changelog was part of the README, but its now moved to its own file.

- 2024-07-30 - Initial commit, almost all features from Brucebot 1.0 moved over. Complete rewrite of bot from scratch, largely due to a rewrite of the Databruce project.
- 2024-08-04 - fixed none short_name breaking song embed
- 2024-08-04 - fixed tour not showing up
- 2024-08-04 - fixed incorrect footer on help command (showing bbhelp instead of bhelp)
- 2024-08-04 - fixed tour opener/closer count, was counting soundchecks/rehearsals by accident
- 2024-08-04 - removed timeout on stats embed menu
- 2024-08-04 - add aliases to song search
- 2024-08-16 - update cover finder. Add nugs covers as a fallback if I don't have a cover made for a show that got Nugs release
- 2024-08-16 - fix archive links not having the archive.org url
- 2024-08-21 - fix song search. Had issue with the search ranking, so "Into The Fire" was actually pulling up the first result which was Hendrix's Fire. Switched Rank and Similarity in the ORDER BY, seems to have fixed it.
- 2024-09-08 - remove timeout on covers embed viewmenu
- 2024-09-23 - added venue search command `!venue` or `!v`
- 2024-09-23 - changed song FTS to 'simple', as for unknown reasons the generated vector column was ignoring the song name on some rows.
- 2024-10-01 - added command line argument to specify the database to connect to. When running locally I use the local database, and when deployed it should use Heroku instead.
- 2024-10-08 - Updated a number of commands. Reason being is that I made some major changes to the database in regards to structure. Commands updated: album, bootleg, location, on_this_day, setlist, song, venue.
- 2024-10-10 - fixed info command, was broken after the update mentioned above.
- 2024-10-11 - fixed song command, had similarity in the wrong order and it wasn't catching inputs like 'hope and dreams'
- 2024-10-16 - further database updates, forgot to change the setlist command to match. So the tour was showing the ID instead of the tour name itself.
- 2024-10-19 - added tour leg tracking to the database. Now on the setlist embed if an event is part of a tour leg, it'll show that. Otherwise it'll default to the tour itself.
- 2024-10-30 - fixed `On This Day`. It was showing the band id instead of the name.
- 2024-11-11 - made changes to the database. Merged events and event_details as having them separate just got annoying to deal with. Also removed the "search" views, which I made to help with full text search, but realized I could just use a CTE instead. Updated location, setlist, and song to reflect these changes.
- 2024-11-22
  - forgot to add a "not found" embed to the archive command. There _was_ one in case of a date parsing error, but I forgot to include the one if there are no results.
  - added `snippet` as a command. Allows checking for if a song was ever played as a snippet. Also added a `snippet count` to the normal song embed.
  - updated `album` to new schema. I changed the names of some columns and didn't yet update the bot.
  - fix song embed missing album art, forgot the update the link.
  - added a check to only respond to commands. Found that if someone started their message with multiple exclamation points, or a message of nothing but them, the bot would respond with the invalid command embed. This will only respond to a command like `!CMD`, and ignore stuff like `!!!!!`
- 2024-11-24 - fixed stats command. Forgot to change the tour finder to use the numerical ID for events instead of the brucebase tag.
- 2024-11-26 - fixed tour song count command. Didn't change the joins to reference the tour ID compared to the brucebase tag.
- 2024-12-03 - added event run tracking to the database, and also added it to the setlist embed if an event belongs to a longer run of shows.
- 2024-12-13 - changed song tour stat command to order by num performances descending, instead of chronologically.
- 2025-03-08 - _spongebob narrator voice_ 3 months later
  - reformatted setlist command. Changed the setlist notes to just be on their own instead of inside a codeblock. This allows for embedded links.
  - Setlist note will now link to Musicbrainz if a song was released officially on a retail release (not a nugs archive).
  - added the option to query for setlists using the Brucebase URL and the events id. This allows for getting specific events when there are multiple on a day.
    - The BB URL option was part of the bot, but until now hasn't worked as intended. It would simply pull the date from the url, then continue as usual. So, if there were multiple events, it would get all of them, rather than just the single event for that url.
    - The event_id would simply be parsed as a date and go from there. Which works in the case of single event days, but is pointless for multi-event days.
  - releases are now gotten in one function, rather than one for nugs and archive. Just makes things cleaner.
- 2025-04-07 - updated setlist table in the database, so had to fix a ton of stuff. Changed it to use song id rather than brucebase_url. Makes for easier joins and whatnot.
  - updated: song, album, stats
- 2025-04-08 - moved the song fuzzy search to `utils`, as I use it for multiple commands.
- 2025-04-08 - converted all commands to hybrid commands. Which allows both the newer slash commands AND the classic prefix commands.
- 2025-04-09 - update song embed brucebase button to use correct link
- 2025-04-15 - update archive link embed to only send the menu if there are more than 10 links for given date. Which as of now is none.
- 2025-04-17
  - fixed setlist command sending a "nopages" error embed when a view menu with no pages tries to send.
  - fixed song tour command, removed two generated columns and never changed the command to match.
- 2025-05-03
  - updated `songs_first_release` view to be much simpler. Rather than getting every release for a song, it only gets the first, and includes the release_id. This can then easily be used with a JOIN in SQL to get the rest of the info.
  - updated frequency formula based on Dripfield.pro's method. The original method was `num_plays_public/num_events`, which was sort of incorrect, as it counted *every* event. When in reality, the "correct" way is to count events that have happened since the song premiered. This doesn't change the values a ton, but they should be slightly more correct now.
  - Added musicbrainz link to song embed.
  - fixed venue links not showing up right. Somehow, the `venues_text` table got wiped and everything set to NULL. Really not sure how that happened, as the SQL command is still in the backups.
  - added tour leg and event run to embed description
- 2025-05-04
  - fixed setlist embed showing "None" for an event without an early/late marker.
- 2025-05-06
  - fixed `on this day` command. For some reason, it was defaulting to a full date no matter what was entered. So, something like `!otd 11-18` would return "2025-11-18", and it would fail trying to find events because it was trying to find a full date instead of `MM-DD`. This should be fixed now. Only quirk is that entering dates that don't exist (like May 32) will default to the current date with the wrong day as the year (so May 32 results in 2032-05-06 today). It still works so this is fine.
- 2025-05-14
  - fixed song gap calculation on the song embed. It was counting number of shows since a long was last played, but it was going from the last event in the table, including ones that haven't happened yet. Redid it so it should be more accurate now.